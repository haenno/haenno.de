import{d as p,a as h,o as m,b as y,c as r,e as _,u as d,B as w,f as u,F as g,r as k,g as c,n as x,t as f}from"./index-e6ce3fe9.js";const j="https://drfjwt.haenno.de/news_api/latest_news/",N="https://drfjwt.haenno.de/news_api/news_after_id/",T="https://drfjwt.haenno.de/news_api/fake_news/",l=new Headers;l.append("Content-Type","application/json; charset=UTF-8");l.append("Accept","application/json");const v=p("newsstore",{state:()=>({last_id:0,news_array:[]}),getters:{getLastId(){return this.last_id},getNewsArray(){return this.news_array.sort((s,e)=>e.id-s.id)}},actions:{async get_latest_news(){const s=await fetch(j,{headers:l,method:"GET"});if(console.log(s),s.ok){const e=await s.json();console.log(e);for(let t=0;t<e.length;t++)if(e[t].id>this.last_id&&(this.last_id=e[t].id),this.news_array.find(n=>n.id===e[t].id)){console.log("passing duplicate");continue}else console.log("adding new news"),this.news_array.push({id:e[t].id,text:e[t].news_text})}else{console.log("get_latest_news: did NOT work!");const e=await s.json();return{status:s.status,message:e.detail}}},async get_news_after_id(){console.log("get_news_after_id"),this.last_id===0&&this.get_latest_news();const s=N+this.last_id+"/",e=await fetch(s,{headers:l,method:"GET"});if(console.log(e),e.ok){const t=await e.json();console.log(t);for(let n=0;n<t.length;n++)if(t[n].id>this.last_id&&(this.last_id=t[n].id),this.news_array.find(i=>i.id===t[n].id)){console.log("passing duplicate");continue}else console.log("adding new news"),this.news_array.push({id:t[n].id,text:t[n].news_text})}else{console.log("get_latest_news: did NOT work!");const t=await e.json();return{status:e.status,message:t.detail}}},async create_fake_news(){const s=await fetch(T,{headers:l,method:"GET"}),e=await s.json();console.log(e),s.ok?console.log("fake news created!"):console.log("fake news NOT created!")}}}),b=u("h1",null,"This is an news page",-1),C={id:"news_box",class:"m-5 scroll-p-2 overflow-auto h-40 flex flex-col-reverse px-4 py-2 bg-gray-200 rounded-t-lg dark:bg-gray-700"},E=h({__name:"NewsView",setup(s){const e=v();let t=0;m(()=>{console.log("news updated"),t!=e.last_id&&(t=e.last_id,n(`news-index-${e.last_id}`))}),setInterval(()=>{e.get_news_after_id()},2e3),y(()=>{e.get_latest_news(),n(`news-index-${e.last_id}`)});function n(i){const a=document.getElementsByClassName(i)[0];a?a.scrollIntoView({behavior:"smooth"}):console.log("element not found")}return(i,a)=>(c(),r(g,null,[b,_(w,{button:{text:"Get news"},class:"w-full",onClick:a[0]||(a[0]=o=>d(e).get_latest_news())}),_(w,{button:{text:"Create more news"},class:"w-full",onClick:a[1]||(a[1]=o=>d(e).create_fake_news())}),u("div",C,[(c(!0),r(g,null,k(d(e).getNewsArray,o=>(c(),r("div",{key:o.id,class:x(`news-index-${o.id}`)},f(o.id)+": "+f(o.text),3))),128))])],64))}});export{E as default};
